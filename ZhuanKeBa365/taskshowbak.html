<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="misapplication-tap-highlight" content="no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="HandheldFriendly" content="true" />
		<meta name="MobileOptimized" content="320" />
		<title>任务中心</title>
		<link href="css/mui.min.css" rel="stylesheet" />
		<link href="css/base.css" rel="stylesheet" />
		<link href="css/main.css" rel="stylesheet" />
		<link href="css/weui.min.css" rel="stylesheet" />
		<link href="css/weui.plus.css" rel="stylesheet" />
		<script src="js/mui.min.js"></script>
		<script src="js/common.js"></script>

		<script type="text/javascript" src="js/zepto.min.js"></script>
		<script type="text/javascript" src="js/zkb.js"></script>
		<style type="text/css">

		</style>
		<script>
			mui.plusReady(function() {
				$(document).ready(function() {
					var useName = plus.storage.getItem('usename');
					var apptoken = plus.storage.getItem('apptoken');
					plus.nativeUI.showWaiting('加载中...');
					var oid = getQueryString("oid");
					$.ajax({
						url: AliceHost + '/Home/TaskDeal',
						data: {
							userId: useName,
							apptoken: apptoken,
							oid: oid
						},
						type: 'post',
						dataType: 'json',
						timeout: 3000,
						contentType: "application/x-www-form-urlencoded; charset=utf-8",
						success: function(data) {
							plus.nativeUI.closeWaiting();
							if(data.code == "1") {
								$("#bgimg").css("background-image", "url(http://www.zkb365.com" + data.data.OrdersInfo.imageUrl1 + ")");
								$("#mainimg").attr("src", "http://www.zkb365.com" + data.data.OrdersInfo.imageUrl1);
								$("#gjc").html("关键词：" + data.data.OrderItem.Keyword);
								$("#gjc").data("keyword", data.data.OrderItem.Keyword);
								$("#zsjg").html("搜索展示价格：" + data.data.OrdersInfo.productPublicPrice1 + "元");
								$("#cjjg").html("成交价格：" + data.data.OrdersInfo.productActualPrice1 + "元");
								$("#pxsl").html("拍下数量：" + data.data.OrdersInfo.productCount1 + " &nbsp;&nbsp;&nbsp;收货人数：" + data.data.OrdersInfo.receivingNum);
								$("#yongjin").html(data.data.OrderItem.Commission + "元");
								if(data.data.OrdersInfo.freeShopping == 1) {
									$("#isbaoyou").html("是");
								} else {
									$("#isbaoyou").html("否");
								}
								$("#shopname").html(data.data.Shop.ShopName);
								$("#sjbz").html(data.data.OrdersInfo.remark);
								$("#taskID").val(data.data.OrderItem.ID);
								$("#orderno").val(data.data.OrderItem.Sku);
								$("#shopfee").val(data.data.OrderItem.ShopFee);
								if(data.data.OrderItem.ImgUrl1 != "") {
									$("#img1").css("background-image", "url(http://www.zkb365.com" + data.data.OrderItem.ImgUrl1 + ")");
									$("#hdjietuold").val(data.data.OrderItem.ImgUrl1);
								}
								if(data.data.OrderItem.ItemState == 20 || data.data.OrderItem.ItemState == 30) {
									$("#btnshow").show();
								} else {
									$("#btnshow").hide();
								}
							}
						}
					});
				});
				$('#btnsure').on('tap', function() {
					console.log("aaa");
					var useName = plus.storage.getItem('usename');
					var apptoken = plus.storage.getItem('apptoken');
					plus.nativeUI.showWaiting('提交中...');
					var orderno = $("#orderno").val();
					var shopfee = $("#shopfee").val();
					var hdjietu = $("#hdjietu").val();
					var hdjietuold = $("#hdjietuold").val();
					var taskID = $("#taskID").val();
					if(orderno == "") {
						showToast("订单号不能为空");
						plus.nativeUI.closeWaiting();
						return;
					}
					if(hdjietu == "" && hdjietuold == "") {
						showToast("请上传付款截图");
						plus.nativeUI.closeWaiting();
						return;
					}
					$.post(AliceHost + "/home/posttask", {
						orderno: orderno,
						shopfee: shopfee,
						hdjietu: hdjietu,
						hdjietuold: hdjietuold,
						taskID: taskID,
						userId: useName,
						apptoken: apptoken
					}, function(data) {
						plus.nativeUI.closeWaiting();
						if(data.code == "0") {
							mui.toast(data.msg);
						} else {
							mui.toast(data.msg);
							// 获取目标口窗口对象
							var target = plus.webview.getWebviewById('index_task1.html');
							// 执行相应的事件
							mui.fire(target, 'initpage1', {});
							// 执行关闭
							mui.back();
						}
					}, "json");
				});
				$("#gjc").on("tap", function() {
					copykeys();
				});
				$("#copybtn").on("tap", function() {
					copykeys();
				});
				function copykeys(){
					var copycontent = $('#gjc').data('keyword');
					if(plus.os.name == "Android") {
						var Context = plus.android.importClass("android.content.Context");
						var main = plus.android.runtimeMainActivity();
						var clip = main.getSystemService(Context.CLIPBOARD_SERVICE);
						plus.android.invoke(clip, "setText", copycontent);
						var value = plus.android.invoke(clip, "getText");
					}
					if(plus.os.name == "iOS") {
						var UIPasteboard = plus.ios.importClass("UIPasteboard");
						var generalPasteboard = UIPasteboard.generalPasteboard();
						generalPasteboard.setValueforPasteboardType(copycontent, "public.utf8-plain-text");
						var value = generalPasteboard.valueForPasteboardType("public.utf8-plain-text");
					}
					mui.toast('已复制关键词');
				}
			});

			function showimg() {
				$("#proimg").fadeIn();
			}

			function hideimg() {
				$("#proimg").fadeOut();
			}
		</script>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav bg-bgm">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left fcw"></a>
			<h1 id="title" class="mui-title fcw">任务处理</h1>
		</header>
		<div class="mui-content">
			<div class="weui-gallery" style="display: none" id="proimg">
				<span class="weui-gallery-img" id="bgimg"></span>
				<div class="weui-gallery-opr">
					<a href="javascript:" class="weui-gallery-del" onclick="hideimg()">
						<i style="font-style:normal;color:#FFF">关闭</i>
					</a>
				</div>
			</div>
			<div class="weui-panel weui-panel_access">
				<div class="weui-panel__bd">
					<div class="weui-media-box weui-media-box_appmsg">
						<div class="weui-media-box__hd">
							<img class="weui-media-box__thumb" src="" id="mainimg" width="80" height="80" onclick="showimg()">
						</div>
						<div class="weui-media-box__bd" style="position: relative;">
							<a href="javascript:;" id="copybtn" class="weui-btn weui-btn_mini weui-btn_default" style="position: absolute;top:0px;right: 0px;">复制</a>
							<p class="weui-media-box__desc lh20" id="gjc" style="line-height: 20px;">
								关键词：搜索关键词
							</p>
							<p class="weui-media-box__desc lh20" id="zsjg" style="line-height: 20px;">
								搜索展示价格：0.00元
							</p>
							<p class="weui-media-box__desc lh20" id="cjjg" style="line-height: 20px;">
								成交价格：0.00元
							</p>
							<p class="weui-media-box__desc lh20" id="pxsl" style="line-height: 20px;">
								拍下数量：0 &nbsp;&nbsp;&nbsp;收货人数：0
							</p>
						</div>
					</div>
				</div>
			</div>
			<div class="weui-cells__title fcm">搜索细节</div>
			<div class="weui-cells weui-cells_form fs14">
				<div class="weui-cell" style="padding:0px 15px">
					<div class="weui-cell__hd"><label class="weui-label inputtxt">佣金</label></div>
					<div class="weui-cell__bd" id="yongjin">
						0.00元
					</div>
				</div>
				<div class="weui-cell" style="padding:0px 15px">
					<div class="weui-cell__hd"><label class="weui-label inputtxt">任务类型</label></div>
					<div class="weui-cell__bd fcm" id="renwuleixing">
						淘宝任务
					</div>
				</div>
				<div class="weui-cell" style="padding:0px 15px">
					<div class="weui-cell__hd"><label class="weui-label inputtxt">返款方式</label></div>
					<div class="weui-cell__bd">
						平台系统返款
					</div>
				</div>
				<div class="weui-cell" style="padding:0px 15px">
					<div class="weui-cell__hd"><label class="weui-label inputtxt">是否包邮</label></div>
					<div class="weui-cell__bd" id="isbaoyou">
						是
					</div>
				</div>
				<div class="weui-cell" style="padding:0px 15px">
					<div class="weui-cell__hd"><label class="weui-label inputtxt">店铺名称</label></div>
					<div class="weui-cell__bd" id="shopname"></div>
				</div>
				<div class="weui-cell" style="padding:0px 15px">
					<div class="weui-cell__hd"><label class="weui-label inputtxt">商家备注</label></div>
					<div class="weui-cell__bd" id="sjbz"></div>
				</div>
			</div>
			<div class="weui-cells__title fcm">任务提交</div>
			<div class="weui-cells weui-cells_form fs14">
				<div class="weui-cell">
					<div class="weui-cell__hd"><label class="weui-label inputtxt">订单号</label></div>
					<div class="weui-cell__bd">
						<input type="hidden" name="taskID" id="taskID" value="" />
						<input class="weui-input" type="text" placeholder="请输入订单号" id="orderno" name="orderno" value="" />
					</div>
				</div>
				<div class="weui-cell">
					<div class="weui-cell__hd"><label class="weui-label inputtxt">邮费</label></div>
					<div class="weui-cell__bd">
						<input class="weui-input" type="text" placeholder="请输入邮费" id="shopfee" name="shopfee" value="0.00" />
					</div>
				</div>
				<div class="weui-cell">
					<div class="weui-cell__hd"><label class="weui-label inputtxt">付款截图</label></div>
					<div class="weui-cell__bd">
						<div class="weui-uploader">
							<div class="weui-uploader__bd">
								<ul class="weui-uploader__files" id="shenfenimg">
									<li class="weui-uploader__file userimg" id="img1"><input id="uploaderJieTu" class="weui-uploader__input" type="file" capture="camera" accept="image/*;" /></li>
								</ul>
								<input type="hidden" id="hdjietu" name="hdjietu" value="" />
								<input type="hidden" id="hdjietuold" name="hdjietuold" value="" />
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="weui-btn-area" id="btnshow">
				<a class="weui-btn edo-btn_sure" href="javascript:" id="btnsure">确定</a>
			</div>
		</div>
	</body>
	<script src="js/localimg.js" type="text/javascript"></script>
	<script src="js/fix.js" type="text/javascript"></script>
	<script type="text/javascript">
		$("#uploaderJieTu").localResizeIMG({
			width: 800,
			quality: 0.9,
			success: function(result) {
				$("#img1").css("background-image", "url(" + result.base64 + ")");
				$("#hdjietu").val(encodeURI(result.clearBase64));
			}
		});
	</script>

</html>